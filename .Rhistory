head(v.all)
unique(v.all$year)
require(gganimate); library(gifski)
install.packages('gifski')
animate(myp, duration = 10, fps = 20, width = 6,
height = 6, unit = 'in', res = 420, renderer = gifski_renderer())
myp <- ggplot(v.all, aes(x=X1, y = X2, col = Area)) +
geom_point(size = 2) +
ggthemes::theme_solid()+
scale_color_manual(values = c('goldenrod','seagreen4')) +
facet_wrap(~Area) +
transition_reveal(year)
animate(myp, duration = 10, fps = 20, width = 6,
height = 6, unit = 'in', res = 420, renderer = gifski_renderer())
Q
##  Composite F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
##  Composite F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, Yield_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = yield)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total Yield')
FSB|FYIELD
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, Yield_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = F_total, y = Yield_Total, fill = yield)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, Yield_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = F_total, y = yield)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/FF_Area2)
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total)
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total) %>%
reshape2::melt(id = c("F_total","FA1prop"))
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop"))
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value,
color = FA1prop, group = FA1prop) %>%
select(-variable,-value) %>%
ggplot(., aes(x = F_total, y = yield)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FYIELD
FYIELD
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value,
color = FA1prop, group = FA1prop) %>%
select(-variable,-value) %>%
ggplot(., aes(x = F_total, y = yield)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value,
color = FA1prop, group = FA1prop)
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value,
color = FA1prop, group = FA1prop) %>%
select(-variable,-value)
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-area)
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
geom_line() +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
# geom_line() +
geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FYIELD
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
geom_line(lwd = 1) +
# geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FF_test <- expand.grid(FF1 = seq(0,10,0.05),FF2 = seq(0,1,0.05) )
out <- data.frame()
for(i in 1:nrow(FF_test)){
FF_temp <- as.numeric(c(FF_test[i,]))
out[i,'FF_Area1'] <- FF_temp[1];   out[i,'FF_Area2'] <- FF_temp[2];
NA12 <- getNA12(nage=nage,
narea=narea,
XIJ=XIJ,
mort=mort,
FF=FF_temp) ## returns orange box from excel (deterministic)
## find pars only need once
if(i == 1){
opt_temp <- optim(par = c(4,0.6),
NA_12 = NA12,
prop_RA1=prop_RA1,
R0_input=R0_input,
lower = c(0,0),
upper = c(NA,1),
method = "L-BFGS-B",
fn = optimFunc, hessian = FALSE)
}
## return exp, obs with optimized values
opt_vals <- getStuff(par = opt_temp$par,
NA12, ## unchanged
prop_RA1,
R0_input)
out[i,'estRbar'] <- opt_temp$par[1];  out[i,'estRprop'] <- opt_temp$par[2];
out[i,'expR_A1'] <- opt_vals$expR[1];  out[i,'expR_A2'] <- opt_vals$expR[2];
out[i,'obsR_A1'] <- opt_vals$obsR[1];  out[i,'obsR_A2'] <- opt_vals$obsR[2];
out[i,'SB_A1'] <- opt_vals$SB[1];  out[i,'SB_A2'] <- opt_vals$SB[2];
out[i,'SB0_A1'] <- opt_vals$SB_0[1];  out[i,'SB0_A2'] <- opt_vals$SB_0[2];
out[i,'Yield_A1'] <- opt_vals$yield[1];  out[i,'Yield_A2'] <- opt_vals$yield[2]; ## build this
rm(NA12)
}
## 2d F vs SSB and Yield plots----
FSB <- out %>%
select(FF_Area1,FF_Area2,SB_A1,SB_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
facet_wrap(~Area) +
labs(x = 'F in Area 1 (age 2)', y = 'F in Area 2 (age 2)', fill = 'SB in area')
FYIELD <- out %>%
select(FF_Area1,FF_Area2,Yield_A1,Yield_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = yield)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c(option = 'magma') +
facet_wrap(~Area) +
labs(x = 'F in Area 1 (age 2)', y = 'F in Area 2 (age 2)', fill = 'Yield in area')
FSB/FYIELD
##  F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2) %>%
select(FF_Area1,FF_Area2, SB_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = yield)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total Yield')
FSB|FYIELD
out <- subset(out, SB_A1 >0 & SB_A2 >0)
## 2d F vs SSB and Yield plots----
FSB <- out %>%
select(FF_Area1,FF_Area2,SB_A1,SB_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
facet_wrap(~Area) +
labs(x = 'F in Area 1 (age 2)', y = 'F in Area 2 (age 2)', fill = 'SB in area')
FYIELD <- out %>%
select(FF_Area1,FF_Area2,Yield_A1,Yield_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = yield)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c(option = 'magma') +
facet_wrap(~Area) +
labs(x = 'F in Area 1 (age 2)', y = 'F in Area 2 (age 2)', fill = 'Yield in area')
FSB/FYIELD
##  Composite F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
geom_line(lwd = 1) +
# geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FSB|FYIELD
##  Composite F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total) %>%
reshape2::melt(id = c("F_total")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
FSB
out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 )
out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total)
out %>%
mutate(SB_Total = SB_A1+SB_A2,
F_total = FF_Area1+FF_Area2 ) %>%
select(F_total, SB_Total) %>%
reshape2::melt(id = c("F_total"))
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2,
F_total = FF_Area1+FF_Area2,
FA1prop = FF_Area1/F_total) %>%
select(F_total, Yield_Total,FA1prop) %>%
reshape2::melt(id = c("F_total","FA1prop")) %>%
mutate(Area = substr(variable,7,8), yield = value ) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = F_total, y = yield, color = FA1prop, group = FA1prop)) +
geom_line(lwd = 1) +
# geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
FYIELD
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2"))
out %>%
mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value)
out %>%
# mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_A1,Yield_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2"))
out %>%
# mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_A1,Yield_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value)
out %>%
select(FF_Area1,FF_Area2, Yield_A1,Yield_A2) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = FF_Area1, y = yield, color = FF_Area2, group = FF_Area2)) +
geom_line(lwd = 1) +
# geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'Total F',
y = 'Total Yield')
out %>%
select(FF_Area1,FF_Area2, Yield_A1) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value,-Area) %>%
ggplot(., aes(x = FF_Area1, y = yield, color = FF_Area2, group = FF_Area2)) +
geom_line(lwd = 1) +
# geom_point(size = 1) +
ggsidekick::theme_sleek() +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'F in Area 1',
y = 'Yield in Area 1')
out %>% filter(FF_Area1 == 1 & FF_Area2 == 0.5)
##  F vs Composite SSB and Yield plots ----
FSB <- out %>%
mutate(SB_Total = SB_A1+SB_A2) %>%
select(FF_Area1,FF_Area2, SB_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,4,5), SB= value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = SB)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) +
scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c() +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total SB')
FYIELD <- out %>%
mutate(Yield_Total = Yield_A1+Yield_A2) %>%
select(FF_Area1,FF_Area2, Yield_Total) %>%
reshape2::melt(id = c("FF_Area1","FF_Area2")) %>%
mutate(Area = substr(variable,7,8), yield = value) %>%
select(-variable,-value) %>%
ggplot(., aes(x = FF_Area1, y = FF_Area2, fill = yield)) +
geom_tile() +
coord_equal() +
ggsidekick::theme_sleek() +
scale_x_continuous(expand = c(0,0)) + scale_y_continuous(expand = c(0,0)) +
scale_fill_viridis_c(option = 'magma') +
labs(x = 'F in Area 1 (age 2)',
y = 'F in Area 2 (age 2)',
fill = 'Total Yield')
FSB|FYIELD
s
