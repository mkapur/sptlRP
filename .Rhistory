NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,500)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*dat[age,'mortality',slice]
cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]*(1-FF[jarea])
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y]*(1-FF[area]) + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age
YPR[area,age,slice,y] <- dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y] ## disregard selex
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
NPR_SURV
dat[age,"proportion_stay",area]
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]*(1-FF[jarea])
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y]*(1-FF[area]) + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age
YPR[area,age,slice,y] <- dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y] ## disregard selex
} ## end ages 0:nage
} ## end areas
NPR
for(y in 1:2){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,500)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*dat[age,'mortality',slice]
cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]*(1-FF[jarea])
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y]*(1-FF[area]) + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age
YPR[area,age,slice,y] <- dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y] ## disregard selex
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
NPR
for(y in 1:50){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,500)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*dat[age,'mortality',slice]
cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]*(1-FF[jarea])
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y]*(1-FF[area]) + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age
YPR[area,age,slice,y] <- dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y] ## disregard selex
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,500)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*dat[age,'mortality',slice]
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]*(1-FF[jarea])
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y]*(1-FF[area]) + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age
YPR[area,age,slice,y] <- dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y] ## disregard selex
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
plot(NPR[,2:20,,100])
NPR[,2:20,,100]
NPR[,2:20,,5]
YPR[,,,100]
source(here("R","fnxs.R"))
## settings, unchanged
R0_global <- 4
Rprop_input <- 0.65
steep = c(0.7,0.7)
scen
s
FFs <- expand.grid(seq(0,0.9999,0.05),seq(0,0.9999,0.05))
out <- makeOut(dat, FFs)
propmsytemp <- getMSY()
out2 <- makeOut2(propmsy=propmsytemp)
filetemp <- here('figs',paste0(Sys.Date(),"-h=",paste0(steep[1],"_",steep[2]),"-",SCENARIO))
dir.create(filetemp)
source(here('R','figs.R'))
save(out, file = paste0(filetemp,'/out.RDATA'))
save(out2, file =  paste0(filetemp, '/out2.RDATA'))
save(propmsytemp, file =  paste0(filetemp, '/propmsy.RDATA'))
head(dat)
exp(-0.2+0.1)
exp(-0.2-0.1)
exp(-0.2)+exp(-0.1)
exp(-0.2)*exp(-0.1)
exp(-0.2)
log(exp(-0.2))
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,100)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*
dat[age,'mortality',slice]*exp(-FF[area])
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- (1-pLeave)*NPR_SURV[area,age,slice,y]) + NCome)
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age - use baranov catch equation!
## bpr IS Wa x Nax
YPR[area,age,slice,y] <- (dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y]*
(1-dat[age,'mortality',slice]*exp(-FF[area])))/(log(dat[age,'mortality',slice])+FF[area])
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,100)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*
dat[age,'mortality',slice]*exp(-FF[area])
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]*dat[age,'mortality',slice]
} ## end first year setup
} ## end age > recruit
# } ## end age < maxage
# if(age == max(nage)){
#   NPR_SURV[area,age,slice,y] <-NPR_SURV[area,nage-1,slice,y-1]*dat[age,'mortality',slice]/(1-dat[age,'mortality',slice])
# } ## end plus group
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- (1-pLeave)*NPR_SURV[area,age,slice,y] + NCome
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age - use baranov catch equation!
## bpr IS Wa x Nax
YPR[area,age,slice,y] <- (dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y]*
(1-dat[age,'mortality',slice]*exp(-FF[area])))/(log(dat[age,'mortality',slice])+FF[area])
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
plot(NPR[,,,100])
plot(NPR[,,,100]/100)
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,100)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*
dat[age,'mortality',slice]*exp(-FF[area])
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]* dat[age,'mortality',slice]*exp(-FF[area])
} ## end first year setup
} ## end age > recruit
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]
# cat(NCome,"\n")
} # end i != j
} # end subareas j
## note, they are fished "before" moving; so NCome includes fishery deaths experienced in area-from
if(age >1) NPR[area,age,slice,y] <- (1-pLeave)*NPR_SURV[area,age,slice,y] + NCome
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]## weight in 3 and 4 col
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age - use baranov catch equation!
## bpr IS Wa x Nax
YPR[area,age,slice,y] <- (dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y]*
(1-dat[age,'mortality',slice]*exp(-FF[area])))/(log(dat[age,'mortality',slice])+FF[area])
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
plot(NPR[,,,100]/100)
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,100)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*
dat[age,'mortality',slice]*exp(-FF[area])
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]* dat[age,'mortality',slice]*exp(-FF[area])
} ## end first year setup
} ## end age > recruit
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]
# cat(NCome,"\n")
} # end i != j
} # end subareas j
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y] + NCome)/y
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age - use baranov catch equation!
## bpr IS Wa x Nax
YPR[area,age,slice,y] <- (dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y]*
(1-dat[age,'mortality',slice]*exp(-FF[area])))/(log(dat[age,'mortality',slice])+FF[area])
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
plot(NPR[,,,100]/100)
plot(NPR[,,,100])
plot(NPR[,2:20,,100])
for(y in 1:100){
if(y == 1){ ## establish array first time
NPR_SURV <- NPR <- BPR <- SBPR <- YPR <- array(NA, dim = c(narea,nage,narea,100)) ## now 100 years of record
}
NPR_SURV[,1,1,y] <- NPR[,1,1,y] <- c(1,0);  NPR_SURV[,1,2,y] <-  NPR[,1,2,y] <- c(0,1) ## single recruit to each area
for(slice in 1:narea){
## Calc Survivors for each area-age within slice
for(age in 2:nage){
for(area in 1:narea){
## First calc survivors within area
# if(age > 1  & age < max(nage)) {
if(age > 1){
if(y > 1){
## NAA is those which age in from last year plus contribution of recruit
NPR_SURV[area,age,slice,y] <-  (NPR[area,age-1,slice,y-1]+NPR_SURV[area,age-1,slice,y])*
dat[age,'mortality',slice]*exp(-FF[area])
# cat(  NPR_SURV[area,age,slice,y], "\n")
} else{
NPR_SURV[area,age,slice,y] <- NPR_SURV[area,age-1,slice,y]* dat[age,'mortality',slice]*exp(-FF[area])
} ## end first year setup
} ## end age > recruit
} ## end survivors-in-area
} ## end ages 2:nage
for(area in 1:narea){
for(age in 2:nage){
pLeave = NCome = 0
for(jarea in 1:narea){
if(area != jarea){
pLeave = pLeave + (1-dat[age,"proportion_stay",area])
NCome = NCome +(1-dat[age,"proportion_stay",jarea])*NPR_SURV[jarea,age,slice,y]
# cat(NCome,"\n")
} # end i != j
} # end subareas j
if(age >1) NPR[area,age,slice,y] <- ((1-pLeave)*NPR_SURV[area,age,slice,y] + NCome)
} ## end ages 2:nage
for(age in 0:nage){
BPR[area,age,slice,y] <-  NPR[area,age,slice,y]*dat[age,"weight",area]
SBPR[area,age,slice,y] <-  BPR[area,age,slice,y]*dat[age,"maturity",area]
## Calc Yield for each area-age - use baranov catch equation!
## bpr IS Wa x Nax
YPR[area,age,slice,y] <- (dat[age,"fishery_selectivity",area]*FF[area]*BPR[area,age,slice,y]*
(1-dat[age,'mortality',slice]*exp(-FF[area])))/(log(dat[age,'mortality',slice])+FF[area])
} ## end ages 0:nage
} ## end areas
} ## end slices (array)
} ## end 100 years
plot(NPR[,2:20,,100])
YPR
scen
s
SCENARIO <- scen[s,'SCENARIO_NAME']
slx_a50t <- as.numeric(c(scen[s,'SLX_A50_A1'],9))
slx_a95t <- as.numeric(c(scen[s,'SLX_A95_A1'],13))
pStayt <- as.numeric(c(scen[s,'PSTAY_A1'],scen[s,'PSTAY_A2']))
dat <- makeDat(wa = c(5,5),
fec_a50 = c(6,6),
fec_a95 = c(12,12),
slx_a50=slx_a50t,
slx_a95=slx_a95t,
pStay=pStayt)
FFs <- expand.grid(seq(0,0.9999,0.05),seq(0,0.9999,0.05))
out <- makeOut(dat, FFs)
propmsytemp <- getMSY()
out2 <- makeOut2(propmsy=propmsytemp)
filetemp <- here('figs',paste0(Sys.Date(),"-h=",paste0(steep[1],"_",steep[2]),"-",SCENARIO))
dir.create(filetemp)
source(here('R','figs.R'))
save(out, file = paste0(filetemp,'/out.RDATA'))
save(out2, file =  paste0(filetemp, '/out2.RDATA'))
save(propmsytemp, file =  paste0(filetemp, '/propmsy.RDATA'))
